<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>W610 TCP Web Console</title>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css' rel='stylesheet'>
  <script src='https://cdn.socket.io/4.5.4/socket.io.min.js'></script>
  <style>
    #logContainer {
      height: 300px;
      overflow-y: auto;
      font-family: monospace;
      white-space: pre-wrap;
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 1em;
    }
  </style>
</head>
<body class='bg-light'>
  <div class='container mt-4'>
    <div class='d-flex justify-content-between align-items-center mb-3'>
      <h2>W610 TCP Web Console</h2>
      <a href='/logout' class='btn btn-outline-danger btn-sm'>Logout</a>
    </div>
    <div class='mb-3'>
      <strong>Status:</strong> <span id='status' class='text-muted'>disconnected</span>
      <button onclick='connectTCP()' class='btn btn-success btn-sm ms-3'>Connect</button>
      <button onclick='disconnectTCP()' class='btn btn-warning btn-sm ms-1'>Disconnect</button>
    </div>
    <div id='logContainer' class='mb-4'></div>
    <div class='row g-2'>
      <div class='col-auto'>
        <select id='dataType' class='form-select'>
          <option value='text'>Text</option>
          <option value='hex'>Hex</option>
        </select>
      </div>
      <div class='col'>
        <input type='text' id='inputData' class='form-control' placeholder='Enter text or hex'>
      </div>
      <div class='col-auto'>
        <button onclick='sendData()' class='btn btn-primary'>Send</button>
      </div>
    </div>
  </div>
  <script>
    const socket = io();
    const logContainer = document.getElementById('logContainer');

    socket.on('tcp_status', msg => {
      document.getElementById('status').innerText = msg.status;
    });

    socket.on('tcp_response', msg => {
      const logLine = `[${msg.timestamp}]
[HEX] ${msg.hex}
${msg.text}
`;
      const div = document.createElement('div');
      div.textContent = logLine;
      logContainer.appendChild(div);
      logContainer.scrollTop = logContainer.scrollHeight;
    });

    function connectTCP() {
      socket.emit('connect_tcp');
    }

    function disconnectTCP() {
      socket.emit('disconnect_tcp');
    }

    function sendData() {
      const type = document.getElementById('dataType').value;
      const data = document.getElementById('inputData').value;
      if (!data) return;
      socket.emit('send_data', { type, text: data, hex: data });
    }
  </script>
</body>
</html>