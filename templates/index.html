<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>W610 TCP Web Console</title>
  <script src='https://cdn.socket.io/4.5.4/socket.io.min.js'></script>
  <style>
    #logContainer {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 0.5em;
      font-family: monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>W610 TCP Web Console</h2>
  <p>Status: <span id='status'>disconnected</span></p>
  <button onclick='connectTCP()'>Connect</button>
  <button onclick='disconnectTCP()'>Disconnect</button>
  <a href='/logout'>Logout</a>
  <hr>
  <div id='logContainer'></div>
  <br>
  <select id='dataType'>
    <option value='text'>Text</option>
    <option value='hex'>Hex</option>
  </select>
  <input type='text' id='inputData' placeholder='Enter text or hex'>
  <button onclick='sendData()'>Send</button>
  <script>
    const socket = io();
    const logContainer = document.getElementById('logContainer');

    socket.on('tcp_status', msg => {
      document.getElementById('status').innerText = msg.status;
    });

    socket.on('tcp_response', msg => {
      const logLine = `[${msg.timestamp}]
[HEX] ${msg.hex}
${msg.text}
`;
      const div = document.createElement('div');
      div.textContent = logLine;
      logContainer.appendChild(div);
      logContainer.scrollTop = logContainer.scrollHeight;
    });

    function connectTCP() {
      socket.emit('connect_tcp');
    }

    function disconnectTCP() {
      socket.emit('disconnect_tcp');
    }

    function sendData() {
      const type = document.getElementById('dataType').value;
      const data = document.getElementById('inputData').value;
      if (!data) return;
      socket.emit('send_data', { type, text: data, hex: data });
    }
  </script>
</body>
</html>